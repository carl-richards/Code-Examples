WITH policies AS (SELECT cpm.strpolnbr, ccr.strclientcd ccr_strclientcd, cpm.strclientcd cpm_strclientcd
                  FROM   com_policy_m cpm, com_client_reln ccr
                  WHERE  cpm.strclientcd = ccr.strreldtoclient),
    first_claim AS (SELECT cad.strclaimnbr
                          ,cad.strpolnbr
                          ,cad.strclaimon
                          ,cad.dtclaimnoti
                          ,cad.dtadmission
                          ,cad.dnetclaimamnt
                          ,cad.lwrntranid
                          ,cad.nbentype
                          ,cad.dtclaimpaid
                    FROM   clm_applc_dtl cad
                    WHERE  cad.nclaimstatcd IN (9, 16)
                       AND cad.nclaimtype NOT IN (102, 103)),
    second_claim AS (SELECT cad.strclaimnbr
                           ,cad.strpolnbr
                           ,cad.strclaimon
                           ,cad.dtclaimnoti
                           ,cad.dtadmission
                           ,cad.dnetclaimamnt
                           ,cad.lwrntranid
                           ,cad.nbentype
                           ,cad.dtclaimpaid
                     FROM   clm_applc_dtl cad
                     WHERE  cad.nclaimstatcd IN (9, 16)
                        AND cad.nclaimtype NOT IN (102, 103))
SELECT p.strpolnbr
      ,fc.nbentype
      ,fc.dtclaimnoti
      ,fc.dtadmission
      ,fc.dnetclaimamnt
      ,fc.lwrntranid
      ,sc.nbentype
      ,sc.dtclaimnoti
      ,sc.dtadmission
      ,sc.dnetclaimamnt
      ,sc.lwrntranid
      ,ccm.strfirstname || ' ' || ccm.strlastname
FROM   policies p
      ,first_claim fc
      ,second_claim sc
      ,com_client_m ccm
WHERE  p.strpolnbr = fc.strpolnbr
   AND p.strpolnbr = sc.strpolnbr
   AND fc.strclaimnbr <> sc.strclaimnbr
   AND fc.strclaimon = sc.strclaimon
   AND fc.nbentype = sc.nbentype
   AND fc.dtclaimnoti < sc.dtclaimnoti
   AND fc.dtclaimpaid < sc.dtclaimpaid
   AND fc.dtadmission > sc.dtadmission
   AND (p.ccr_strclientcd = ccm.strclientcd
     OR p.cpm_strclientcd = ccm.strclientcd)
   AND fc.strclaimon = ccm.strclientcd;